<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="//use.fontawesome.com/releases/v5.0.7/css/all.css"
    />
    <link rel="stylesheet" href="/pages/style/gerenciar.css" />
    <title>IF - Lanches</title>
  </head>

  <body>
    <header class="navbar">
      <div class="navbar-left">
        <img
          src="/img/Logoiflanches-removebg-preview.png"
          alt="Logo IF Lanches"
          class="logo"
        />
      </div>

      <nav class="navbar-center">
        <a href="/home">INÍCIO</a>
        <a href="/cardapio">CARDÁPIO</a>
        <a href="/gerenciar" class="link-gerenciar">GERENCIAR</a>
      </nav>

      <div class="navbar-right">
        <span class="saldo">R$ ${usuario.saldo}</span>
        <a href="/perfil"
          ><img
            src="/img/perfil-usuario.jpg"
            alt="Foto de Perfil"
            class="perfil"
            onerror="this.onerror=null; this.src='https://cdn-icons-png.flaticon.com/512/847/847969.png';"
        /></a>
      </div>

      <div class="menu-btn" id="menu-btn">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </header>

    <div class="mobile-menu" id="mobile-menu">
      <a href="/home">INÍCIO</a>
      <a href="/cardapio">CARDÁPIO</a>
      <a href="/gerenciar" class="link-gerenciar">GERENCIAR</a>
    </div>

    <main>
      <h2 id="h2-gere">Cardapio:</h2>

      <h3 class="h3-secti">Salgados</h3>
      <section class="produtos-grid" id="produtosSalgados"></section>


      <h3 class="h3-secti">Bebidas</h3>
      <section class="produtos-grid" id="produtosBebidas"></section>
    </main>

    <dialog id="modalProduto">
      <form class="form-produto">
        <button
          type="button"
          class="close-modal"
          onclick="modalProduto.close()"
        >
          ✕
        </button>

        <h1 id="modalNome"></h1>
        <p id="modalDesc"></p>

        <p><strong>Preço:</strong> R$ <span id="modalPreco"></span></p>
        <p><strong>Quantidade:</strong> <span id="modalQtd"></span></p>

        <br />
        <button type="button" class="btn-add-prod">Comprar</button>
      </form>
    </dialog>

    <dialog id="modalAdd2">
      <form class="form-produto">
        <button type="button" class="close-modal" onclick="modalAdd.close()">
          ✕
        </button>
        <br />
        <br />
        <br />
        <h1>Compra Realizada</h1>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
          <!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
          <path
            fill="#502314"
            d="M320 576C178.6 576 64 461.4 64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576zM320 112C205.1 112 112 205.1 112 320C112 434.9 205.1 528 320 528C434.9 528 528 434.9 528 320C528 205.1 434.9 112 320 112zM390.7 233.9C398.5 223.2 413.5 220.8 424.2 228.6C434.9 236.4 437.3 251.4 429.5 262.1L307.4 430.1C303.3 435.8 296.9 439.4 289.9 439.9C282.9 440.4 276 437.9 271.1 433L215.2 377.1C205.8 367.7 205.8 352.5 215.2 343.2C224.6 333.9 239.8 333.8 249.1 343.2L285.1 379.2L390.7 234z"
          />
        </svg>
      </form>
    </dialog>

    <dialog id="saldoinsufi">
      <form class="form-produto">
        <button type="button" class="close-modal" onclick="modalAdd.close()">
          ✕
        </button>
        <br />
        <br />
        <br />
        <h1>Saldo Insuficiente!</h1>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
          <!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
          <path
            fill="#502314"
            d="M392 176L248 176L210.7 101.5C208.9 97.9 208 93.9 208 89.9C208 75.6 219.6 64 233.9 64L406.1 64C420.4 64 432 75.6 432 89.9C432 93.9 431.1 97.9 429.3 101.5L392 176zM233.6 224L406.4 224L455.1 264.6C521.6 320 560 402 560 488.5C560 536.8 520.8 576 472.5 576L167.4 576C119.2 576 80 536.8 80 488.5C80 402 118.4 320 184.9 264.6L233.6 224zM324 288C313 288 304 297 304 308L304 312C275.2 312.3 252 335.7 252 364.5C252 390.2 270.5 412.1 295.9 416.3L337.6 423.3C343.6 424.3 348 429.5 348 435.6C348 442.5 342.4 448.1 335.5 448.1L280 448C269 448 260 457 260 468C260 479 269 488 280 488L304 488L304 492C304 503 313 512 324 512C335 512 344 503 344 492L344 487.3C369 483.2 388 461.6 388 435.5C388 409.8 369.5 387.9 344.1 383.7L302.4 376.7C296.4 375.7 292 370.5 292 364.4C292 357.5 297.6 351.9 304.5 351.9L352 351.9C363 351.9 372 342.9 372 331.9C372 320.9 363 311.9 352 311.9L344 311.9L344 307.9C344 296.9 335 287.9 324 287.9z"
          />
        </svg>
      </form>
    </dialog>

<script>


      window.addEventListener("DOMContentLoaded", () => {
        function getCookie(nome) {
          return document.cookie
            .split("; ")
            .find((c) => c.startsWith(nome + "="))
            ?.split("=")[1];
        }

        const tipo = getCookie("tipoUsuario");

        if (tipo !== "dono" && tipo !== "admin") {
          document.querySelectorAll(".link-gerenciar").forEach((el) => {
            el.style.display = "none";
          });
        }
      });

  const produtosSalgados = document.getElementById("produtosSalgados");
  const produtosBebidas = document.getElementById("produtosBebidas");

  const modalProduto = document.getElementById("modalProduto");
  const modalNome = document.getElementById("modalNome");
  const modalDesc = document.getElementById("modalDesc");
  const modalPreco = document.getElementById("modalPreco");
  const modalQtd = document.getElementById("modalQtd");


  function criarCard(prod) {
    const card = document.createElement("div");
    card.classList.add("card");

    card.innerHTML = `
      <h3>${prod.nome}</h3>
      <p>Preço: R$ ${Number(prod.preco).toFixed(2)}</p>
      <p>Qtd: ${prod.quantidade}</p>
      <br>
      <button class="btnVerMais">VER MAIS</button>
      <br>
    `;

    card.querySelector(".btnVerMais").addEventListener("click", () => {
      modalNome.textContent = prod.nome;
      modalDesc.textContent = prod.descricao || "Sem descrição";
      modalPreco.textContent = Number(prod.preco).toFixed(2);
      modalQtd.textContent = prod.quantidade;

      modalProduto.showModal();
    });

    if (prod.categoria === "Salgados") produtosSalgados.appendChild(card);
    if (prod.categoria === "Bebidas") produtosBebidas.appendChild(card);
  }

  fetch("/lista/produtos")
    .then(res => res.json())
    .then(lista => lista.forEach(criarCard))
    .catch(err => console.log("Erro ao carregar produtos:", err));
    async function atualizarSaldoMenu() {
  try {
    const resposta = await fetch("/usuario/saldo");
    const dados = await resposta.json();

    if (!dados.saldo) return;

    const saldoFormatado = Number(dados.saldo).toLocaleString("pt-BR", {
      style: "currency",
      currency: "BRL"
    });

    document.querySelectorAll(".saldo").forEach(span => {
      span.textContent = saldoFormatado;
    });

  } catch (e) {
    console.log("Erro ao atualizar saldo:", e);
  }
}

atualizarSaldoMenu();
</script>

  </body>
</html>
