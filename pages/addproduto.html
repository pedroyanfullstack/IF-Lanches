<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/pages/style/addpro.css" />
    <title>IF - Lanches</title>
  </head>
  <body>
    <header class="navbar">
      <div class="navbar-left">
        <img
          src="/img/Logoiflanches-removebg-preview.png"
          alt="Logo IF Lanches"
          class="logo"
        />
      </div>
      <nav class="navbar-center">
        <a href="/home">INÍCIO</a>
        <a href="/cardapio">CARDÁPIO</a>
        <a href="/gerenciar" class="link-gerenciar">GERENCIAR</a>
      </nav>
      <div class="navbar-right">
        <span class="saldo">R$ ${usuario.saldo}</span>
        <a href="/perfil"
          ><img
            src="/img/perfil-usuario.jpg"
            alt="Foto de Perfil"
            class="perfil"
            onerror="this.onerror=null;this.src='https://cdn-icons-png.flaticon.com/512/847/847969.png'"
        /></a>
      </div>
      <div class="menu-btn" id="menu-btn">
        <span></span><span></span><span></span>
      </div>
    </header>

    <div class="mobile-menu" id="mobile-menu">
      <a href="/home">INÍCIO</a>
      <a href="/cardapio">CARDÁPIO</a>
      <a href="/gerenciar" class="link-gerenciar">GERENCIAR</a>
    </div>

    <main>
      <h1>CRIAR PRODUTOS</h1>
      <h2>Adicionar novo produto:</h2>
      <form id="formProduto">
        <input
          type="text"
          id="nomeProduto"
          placeholder="Nome do Produto"
          required
        />
        <input
          type="text"
          id="descProduto"
          placeholder="Nome do Produto"
          required
        />
        <input
          type="number"
          id="precoProduto"
          placeholder="Preço (R$)"
          step="0.01"
          required
        />
        <input
          type="number"
          id="qtdProduto"
          placeholder="Quantidade"
          required
        />
        <select id="categoriaProduto" required>
          <option value="">Selecione a Categoria</option>
          <option value="Salgados">Salgados</option>
          <option value="Bebidas">Bebidas</option>
        </select>
        <button type="submit">Adicionar Produto</button>
      </form>

      <h3>Salgados</h3>
      <section class="produtos-grid" id="produtosSalgados"></section>
      <h3>Bebidas</h3>
      <section class="produtos-grid" id="produtosBebidas"></section>
    </main>

    <script>
      const menuBtn = document.getElementById("menu-btn");
      const mobileMenu = document.getElementById("mobile-menu");
      menuBtn.addEventListener("click", () => {
        menuBtn.classList.toggle("active");
        mobileMenu.classList.toggle("open");
      });

      const formProduto = document.getElementById("formProduto");
      const produtosSalgados = document.getElementById("produtosSalgados");
      const produtosBebidas = document.getElementById("produtosBebidas");

      function criarCard(prod) {
        const card = document.createElement("div");
        card.classList.add("card");
        card.innerHTML = `
      <h3>${prod.nome}</h3>
      <p>${prod.descricao}</p>
      <p>Preço: R$ ${Number(prod.preco).toFixed(2)}</p>
      <p>Qtd: ${prod.quantidade}</p>
    `;
        if (prod.categoria === "Salgados") produtosSalgados.appendChild(card);
        else produtosBebidas.appendChild(card);
      }

      fetch("/lista/produtos")
        .then((res) => res.json())
        .then((lista) => lista.forEach(criarCard))
        .catch((err) => console.log("Erro ao carregar produtos:", err));

      formProduto.addEventListener("submit", function (e) {
        e.preventDefault();

        const nome = document.getElementById("nomeProduto").value;
        const descricao = document.getElementById("descProduto").value;
        const preco = document.getElementById("precoProduto").value;
        const quantidade = document.getElementById("qtdProduto").value;
        const categoria = document.getElementById("categoriaProduto").value;

        const produto = {
          nome,
          descricao,
          categoria,
          quantidade,
          preco,
        };

        fetch("/lista/produtos", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(produto),
        })
          .then((res) => res.json())
          .then(() => {
            criarCard(produto);
            formProduto.reset();
            alert("Produto adicionado com sucesso!");
          })
          .catch(() => alert("Erro ao adicionar produto."));
      });
    </script>
  </body>
</html>
